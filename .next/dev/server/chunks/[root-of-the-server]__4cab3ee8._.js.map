{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/video-gen/app/api/proxy/%5B...path%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\nconst externalApiBaseUrl = 'https://generativelanguage.googleapis.com';\r\n\r\nasync function handleProxy(req: NextRequest, { params }: { params: { path: string[] } }) {\r\n    const path = params.path.join('/');\r\n    const targetUrl = `${externalApiBaseUrl}/${path}`;\r\n    const apiKey = process.env.GEMINI_API_KEY || process.env.API_KEY;\r\n\r\n    if (!apiKey) {\r\n        return NextResponse.json({ error: 'Server configuration error: API Key missing' }, { status: 500 });\r\n    }\r\n\r\n    // Construct query parameters\r\n    const url = new URL(targetUrl);\r\n    req.nextUrl.searchParams.forEach((value, key) => {\r\n        url.searchParams.append(key, value);\r\n    });\r\n    // Inject API Key\r\n    url.searchParams.append('key', apiKey);\r\n\r\n    console.log(`[Proxy] Forwarding ${req.method} request to: ${url.toString()}`);\r\n\r\n    const headers = new Headers(req.headers);\r\n    headers.delete('host');\r\n    headers.delete('connection');\r\n    // Avoid passing sensitive headers if any, or auth headers that might conflict\r\n\r\n    // Prepare fetch options\r\n    const fetchOptions: RequestInit = {\r\n        method: req.method,\r\n        headers: headers,\r\n    };\r\n\r\n    if (['POST', 'PUT', 'PATCH'].includes(req.method)) {\r\n        // For these methods, forward the body.\r\n        // We can read it as arrayBuffer to preserve binary data if any, or text/json.\r\n        // Streaming would be ideal but simple approach:\r\n        const blob = await req.blob();\r\n        fetchOptions.body = blob;\r\n    }\r\n\r\n    try {\r\n        const response = await fetch(url.toString(), fetchOptions);\r\n\r\n        // Create a new response to return to the client\r\n        const responseBody = await response.blob();\r\n\r\n        const newHeaders = new Headers(response.headers);\r\n        // Ensure we don't block anything needed\r\n        newHeaders.set('Access-Control-Allow-Origin', '*');\r\n\r\n        return new NextResponse(responseBody, {\r\n            status: response.status,\r\n            statusText: response.statusText,\r\n            headers: newHeaders,\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Proxy error:', error);\r\n        return NextResponse.json({ error: 'Proxy error', details: error.message }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function GET(req: NextRequest, context: any) {\r\n    return handleProxy(req, context);\r\n}\r\n\r\nexport async function POST(req: NextRequest, context: any) {\r\n    return handleProxy(req, context);\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,qBAAqB;AAE3B,eAAe,YAAY,GAAgB,EAAE,EAAE,MAAM,EAAkC;IACnF,MAAM,OAAO,OAAO,IAAI,CAAC,IAAI,CAAC;IAC9B,MAAM,YAAY,GAAG,mBAAmB,CAAC,EAAE,MAAM;IACjD,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc,IAAI,QAAQ,GAAG,CAAC,OAAO;IAEhE,IAAI,CAAC,QAAQ;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8C,GAAG;YAAE,QAAQ;QAAI;IACrG;IAEA,6BAA6B;IAC7B,MAAM,MAAM,IAAI,IAAI;IACpB,IAAI,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,OAAO;QACrC,IAAI,YAAY,CAAC,MAAM,CAAC,KAAK;IACjC;IACA,iBAAiB;IACjB,IAAI,YAAY,CAAC,MAAM,CAAC,OAAO;IAE/B,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,IAAI,MAAM,CAAC,aAAa,EAAE,IAAI,QAAQ,IAAI;IAE5E,MAAM,UAAU,IAAI,QAAQ,IAAI,OAAO;IACvC,QAAQ,MAAM,CAAC;IACf,QAAQ,MAAM,CAAC;IACf,8EAA8E;IAE9E,wBAAwB;IACxB,MAAM,eAA4B;QAC9B,QAAQ,IAAI,MAAM;QAClB,SAAS;IACb;IAEA,IAAI;QAAC;QAAQ;QAAO;KAAQ,CAAC,QAAQ,CAAC,IAAI,MAAM,GAAG;QAC/C,uCAAuC;QACvC,8EAA8E;QAC9E,gDAAgD;QAChD,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,aAAa,IAAI,GAAG;IACxB;IAEA,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,IAAI,QAAQ,IAAI;QAE7C,gDAAgD;QAChD,MAAM,eAAe,MAAM,SAAS,IAAI;QAExC,MAAM,aAAa,IAAI,QAAQ,SAAS,OAAO;QAC/C,wCAAwC;QACxC,WAAW,GAAG,CAAC,+BAA+B;QAE9C,OAAO,IAAI,gJAAY,CAAC,cAAc;YAClC,QAAQ,SAAS,MAAM;YACvB,YAAY,SAAS,UAAU;YAC/B,SAAS;QACb;IAEJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAe,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACJ;AAEO,eAAe,IAAI,GAAgB,EAAE,OAAY;IACpD,OAAO,YAAY,KAAK;AAC5B;AAEO,eAAe,KAAK,GAAgB,EAAE,OAAY;IACrD,OAAO,YAAY,KAAK;AAC5B"}}]
}